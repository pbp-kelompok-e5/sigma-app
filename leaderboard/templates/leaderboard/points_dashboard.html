{% extends 'base.html' %}
{% load icon_tags %}

{% block title %}Points Dashboard - Sigma App{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center gap-3 mb-2">
            {% icon 'star' size='xl' color='#F26419' %}
            <h1 class="text-3xl sm:text-4xl font-bold text-white">Points Dashboard</h1>
        </div>
        <p class="text-white/80 text-base sm:text-lg">Track your points and achievements</p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <!-- Total Points Card -->
        <div class="card-deep-sea">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-white/60 text-sm font-medium mb-2">Total Points</p>
                    <p class="text-4xl font-bold text-[#F26419]">{{ total_points }}</p>
                </div>
                <div class="text-5xl">{{ badge }}</div>
            </div>
            <div class="mt-4 pt-4 border-t border-white/20">
                <p class="text-white/80 text-sm">Tier: <span class="font-semibold text-[#F26419]">{{ tier }}</span></p>
            </div>
        </div>

        <!-- Rank Card -->
        <div class="card-deep-sea">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-white/60 text-sm font-medium mb-2">Your Rank</p>
                    <p class="text-4xl font-bold text-white">#{{ user_rank|default:"N/A" }}</p>
                </div>
                <div class="text-5xl">üèÜ</div>
            </div>
            <div class="mt-4 pt-4 border-t border-white/20">
                <p class="text-white/80 text-sm">Keep climbing the leaderboard!</p>
            </div>
        </div>

        <!-- Events Card -->
        <div class="card-deep-sea">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-white/60 text-sm font-medium mb-2">Events Attended</p>
                    <p class="text-4xl font-bold text-white">{{ total_events }}</p>
                </div>
                <div class="text-5xl">üéØ</div>
            </div>
            <div class="mt-4 pt-4 border-t border-white/20">
                <p class="text-white/80 text-sm">Keep participating!</p>
            </div>
        </div>
    </div>

    <!-- Points Breakdown -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Activity Breakdown -->
        <div class="card-deep-sea">
            <div class="flex items-center gap-2 mb-6 pb-4 border-b border-white/20">
                {% icon 'chart' size='md' color='#F26419' %}
                <h3 class="text-xl font-semibold text-white">Points Breakdown</h3>
            </div>
            <div class="space-y-4">
                {% for activity_type, data in breakdown.items %}
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10">
                        <div>
                            <p class="text-white font-medium">{{ data.label }}</p>
                            <p class="text-white/60 text-sm">{{ data.count }} activities</p>
                        </div>
                        <p class="text-2xl font-bold text-[#F26419]">+{{ data.total }}</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Recent Achievements -->
        <div class="card-deep-sea">
            <div class="flex items-center gap-2 mb-6 pb-4 border-b border-white/20">
                {% icon 'award' size='md' color='#F26419' %}
                <h3 class="text-xl font-semibold text-white">Recent Achievements</h3>
            </div>
            <div class="space-y-3">
                {% for achievement in achievements|slice:":5" %}
                    <div class="p-3 bg-white/5 rounded-lg border border-white/10">
                        <div class="flex items-start justify-between">
                            <div>
                                <p class="text-white font-medium">{{ achievement.title }}</p>
                                <p class="text-white/60 text-sm">{{ achievement.description }}</p>
                            </div>
                            <span class="text-[#F26419] font-bold">+{{ achievement.bonus_points }}</span>
                        </div>
                    </div>
                {% empty %}
                    <p class="text-white/60 text-center py-4">No achievements yet. Keep playing!</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Recent Transactions -->
    <div class="card-deep-sea">
        <div class="flex items-center justify-between mb-6 pb-4 border-b border-white/20">
            <div class="flex items-center gap-2">
                {% icon 'history' size='md' color='#F26419' %}
                <h3 class="text-xl font-semibold text-white">Recent Transactions</h3>
            </div>
            <a href="{% url 'leaderboard:points_history' %}" class="text-[#F26419] hover:text-[#d94f0f] text-sm font-medium">
                View All ‚Üí
            </a>
        </div>
        <div class="space-y-2">
            {% for transaction in recent_transactions %}
                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-colors">
                    <div class="flex-1">
                        <p class="text-white font-medium">{{ transaction.get_activity_type_display }}</p>
                        <p class="text-white/60 text-sm">{{ transaction.description }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[#F26419] font-bold">+{{ transaction.points }}</p>
                        <p class="text-white/60 text-xs">{{ transaction.created_at|date:"M d, Y" }}</p>
                    </div>
                </div>
            {% empty %}
                <p class="text-white/60 text-center py-4">No transactions yet.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row gap-4 mt-8">
        <a href="{% url 'leaderboard:leaderboard' %}" class="btn btn-primary flex-1 sm:flex-none">
            {% icon 'trophy' size='sm' color='white' %}
            View Leaderboard
        </a>
        <a href="{% url 'leaderboard:achievements' %}" class="btn btn-outline flex-1 sm:flex-none">
            {% icon 'award' size='sm' color='#F26419' %}
            View Achievements
        </a>
    </div>
</div>
{% endblock %}

