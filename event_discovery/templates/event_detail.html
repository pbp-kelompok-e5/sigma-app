{% extends "base.html" %}
{% load icon_tags %}
{% block title %}{{event.title}}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center gap-3 mb-2">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">Event Detail</h1>
        </div>
    </div>

    <!-- Loading State -->
     <div id="loading" class="bg-[#00063D] rounded-lg border border-gray-800 p-12 text-center hidden">
      <svg class="animate-spin h-8 w-8 text-[#F26419] inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      <p class="text-white mt-3">Loading Event...</p>
    </div>

    <!-- Error State -->
    <div id="error" class="hidden">
        <p class="text-red-500">An error occurred while loading the event details. Please try again later.</p>
    </div>

    <!-- Event Detail Container -->
    <article id='event-detail' class="hidden">

    </article>


<script>
// Configuration
const EVENT_ID = "{{ event.id }}";
const EVENT_DETAIL_ENDPOINT = `{% url 'event_discovery:show_json_by_id' '00000000-0000-0000-0000-000000000000' %}`.replace('00000000-0000-0000-0000-000000000000', EVENT_ID);

// DOM Elements
const eventDetailContainer = document.getElementById('event-detail');
const loadingIndicator = document.getElementById('loading');
const errorContainer = document.getElementById('error');

// Load State
function showState(state) {
    loadingIndicator.classList.toggle('hidden', state !== 'loading');
    errorContainer.classList.toggle('hidden', state !== 'error');
    eventDetailContainer.classList.toggle('hidden', state !== 'loaded');
}

// Render Event Detail
function renderEventDetail(event) {
    eventDetailContainer.innerHTML = `
        <h2 class="text-2xl font-bold text-white mb-4">${event.title}</h2>
        <p class="text-white/80 mb-2"><strong>Organizer:</strong> ${event.organizer}</p>
        <p class="text-white/80 mb-2"><strong>Date:</strong> ${event.event_date}</p>
        <p class="text-white/80 mb-2"><strong>Location:</strong> ${event.city}</p>
        <p class="text-white/80 mb-4"><strong>Description:</strong> ${event.description}</p>
        <img src="${event.thumbnail}" alt="Event Thumbnail" class="w-full h-auto rounded-lg mb-4"/>
        <!-- Join/Leave Button -->
        {% if user.is_authenticated %}
            {% if user in event.participants.all %}
                <form method="post" action="{% url 'event_discovery:leave_event' event.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn-secondary">Leave Event</button>
                </form>
            {% else %}
                <form method="post" action="{% url 'event_discovery:join_event' event.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn-primary">Join Event</button>
                </form>
            {% endif %}
        {% else %}
            <p class="text-white/80">Please <a href="{% url 'login' %}" class="text-[#F26419] underline">log in</a> to join this event.</p>
        {% endif %}

    `;
}

// Fetch Event Detail
async function fetchEventDetail() {
    showState('loading');
    try {
        const response = await fetch(EVENT_DETAIL_ENDPOINT);
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        const eventData = await response.json();

        renderEventDetail(eventData);
        showState('loaded');
    } catch (error) {
        console.error('Error fetching event detail:', error);
        showState('error');
    }
}

fetchEventDetail();
</script>
{% endblock content %}